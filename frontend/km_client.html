<!DOCTYPE html>
<html>

<head>
  <title>KM Quantum Key Request</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
  <div class="container mt-4" style="max-width: 500px;">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="mb-4 text-primary">Request Quantum Key</h1>
        <form id="keyForm">
          <div class="mb-3">
            <label for="userEmail" class="form-label">User Email:</label>
            <input type="email" id="userEmail" required class="form-control" />
          </div>
          <div class="mb-3">
            <label for="keyLength" class="form-label">Key Length:</label>
            <select id="keyLength" class="form-select">
              <option value="16">16 bytes (128 bit)</option>
              <option value="24">24 bytes (192 bit)</option>
              <option value="32" selected>32 bytes (256 bit)</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Get Quantum Key</button>
        </form>

        <h2 class="mt-4">Response:</h2>
        <pre id="responseOutput" class="bg-white p-3 rounded shadow-sm" style="white-space: pre-wrap; max-height:300px; overflow:auto;"></pre>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('keyForm').addEventListener('submit', async function (event) {
      event.preventDefault();
      const userEmail = document.getElementById('userEmail').value;
      const keyLength = parseInt(document.getElementById('keyLength').value);

      const responseOutput = document.getElementById('responseOutput');
      responseOutput.textContent = 'Loading...';

      try {
        const response = await fetch('http://127.0.0.1:5000/api/keys', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer demo-token'
          },
          body: JSON.stringify({
            user: userEmail,
            key_length: keyLength
          })
        });

        if (!response.ok) {
          responseOutput.textContent = 'Error: ' + response.status + ' ' + response.statusText;
          return;
        }

        const data = await response.json();
        responseOutput.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        responseOutput.textContent = 'Fetch error: ' + error;
      }
    });
  </script>
</body>

</html>
